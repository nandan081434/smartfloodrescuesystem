<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Create Account | Flood Rescue</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Poppins}

body{
  min-height:100vh;
  background:
    linear-gradient(rgba(0,0,0,.6),rgba(0,0,0,.6)),
    url("assets/map-bg.jpg");
  background-size:cover;
  display:flex;
  align-items:center;
  justify-content:center;
}

/* SUCCESS BAR */
#successBar{
  position:fixed;
  top:0;
  left:0;
  width:100%;
  background:#16a34a;
  color:white;
  text-align:center;
  padding:14px;
  font-weight:600;
  display:none;
  z-index:9999;
}

.signup-card{
  width:480px;
  padding:30px 40px;
  background:rgba(255,255,255,.15);
  backdrop-filter:blur(25px);
  border-radius:30px;
  box-shadow:0 40px 120px rgba(0,0,0,.7);
}

h1{text-align:center;color:white;margin-bottom:6px}
p{text-align:center;color:#dbe7ff;font-size:14px;margin-bottom:20px}

input,select{
  width:100%;
  padding:13px 16px;
  border-radius:14px;
  border:none;
  margin-bottom:12px;
  outline:none;
}

button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:30px;
  background:linear-gradient(135deg,#00c6ff,#0072ff);
  color:white;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

button:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.footer{
  text-align:center;
  margin-top:14px;
  font-size:13px;
  color:#e6ebff;
}

.footer a{color:#8fd3ff;text-decoration:none}
</style>
</head>

<body>

<div id="successBar">✅ Account created successfully! Redirecting…</div>

<div class="signup-card">

  <h1>Create Account</h1>
  <p>Join the Flood Rescue Guidance System</p>

  <input id="email" type="email" placeholder="Email address">
  <input id="phone" type="tel" placeholder="Mobile number">
  <input id="location" type="text" placeholder="Location (City / Area)">
  <input id="password" type="password" placeholder="Password">
  <input id="confirm" type="password" placeholder="Confirm password">

  <select id="role">
    <option value="citizen">Citizen</option>
    <option value="rescue">Rescue Team</option>
  </select>

  <button id="signupBtn" onclick="signup()">Create Account</button>

  <div class="footer">
    Already have an account? <a href="login.html">Login</a><br>
    <a href="index.html">← Back to Welcome</a>
  </div>

</div>

<!-- FIREBASE SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { 
  getAuth, 
  createUserWithEmailAndPassword 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import { 
  getFirestore, 
  doc, 
  setDoc 
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDDc8peb4i19Rku8smgr5BwLxt0WMB9Gjw",
  authDomain: "flood-rescue-guide-ac3a8.firebaseapp.com",
  projectId: "flood-rescue-guide-ac3a8",
  storageBucket: "flood-rescue-guide-ac3a8.appspot.com",
  messagingSenderId: "635830559756",
  appId: "1:635830559756:web:xxxxxx"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

window.signup = function () {
  const email = document.getElementById("email").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const location = document.getElementById("location").value.trim();
  const role = document.getElementById("role").value;
  const password = document.getElementById("password").value;
  const confirm = document.getElementById("confirm").value;
  const btn = document.getElementById("signupBtn");

  if(!email || !password || !confirm || !phone || !location){
    alert("Fill all fields");
    return;
  }

  if(password !== confirm){
    alert("Passwords do not match");
    return;
  }

  btn.disabled = true;

  createUserWithEmailAndPassword(auth, email, password)
    .then(async (userCredential) => {

      const user = userCredential.user;

      await setDoc(doc(db, "users", user.uid), {
        email: email,
        phone: phone,
        location: location,
        role: role,
        createdAt: new Date()
      });

      /* ===== ADDED: SAVE SESSION ROLE ===== */
      localStorage.setItem("userRole", role);
      localStorage.setItem("userEmail", email);
      /* ===================================== */

      document.getElementById("successBar").style.display = "block";

      setTimeout(() => {

        /* ===== ROLE BASED REDIRECT ===== */
        if(role === "citizen"){
          window.location.href = "./citizen-home/home.html";
        }
        else if(role === "rescue"){
          window.location.href = "./rescue-dashboard/home.html";
        }

      }, 1500);
    })
    .catch(err => {
      btn.disabled = false;

      if(err.code === "auth/email-already-in-use"){
        alert("This email is already registered. Please login.");
      } else {
        alert(err.message);
      }
    });
};
</script>

</body>
</html>
